<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Special Request üíñ</title>

  <!-- Responsive + font + theme color -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <meta name="theme-color" content="#ff758c" />

  <style>
    :root{
      --pink-1: #ff758c;
      --pink-2: #ff7eb3;
      --accent: #ff4d6d;
      --card-bg: rgba(255,255,255,0.14);
      --white-faint: rgba(255,255,255,0.25);
    }

    html,body{
      height:100%;
      margin:0;
      font-family: 'Poppins', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color: #fff;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      background: linear-gradient(135deg, var(--pink-1), var(--pink-2));
    }

    /* Layout */
    body{
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      padding:2rem;
    }

    .card {
      background: var(--card-bg);
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      padding: 3.5rem 4.5rem;
      border-radius: 2.2rem;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0,0,0,0.35);
      max-width: 520px;
      width:100%;
      position:relative;
      z-index: 2; /* above hearts */
      transform: translateZ(0);
    }

    h1{
      font-size: clamp(1.4rem, 2.5vw, 2.4rem);
      margin:0 0 1.2rem;
      line-height:1.1;
    }

    p{
      font-size: clamp(1rem, 2vw, 1.15rem);
      margin:0 0 1.8rem;
    }

    .buttons {
      display:flex;
      gap:1.5rem;
      justify-content:center;
      flex-wrap:wrap;
    }

    button{
      border:none;
      padding: .9rem 2.4rem;
      border-radius: 40px;
      font-size: 1.05rem;
      cursor:pointer;
      transition: transform .18s cubic-bezier(.2,.9,.3,1), box-shadow .18s;
      will-change: transform;
      font-weight:600;
    }

    button:focus{
      outline: 3px solid rgba(255,255,255,0.22);
      outline-offset: 4px;
    }

    .primary{
      background: var(--accent);
      color: #fff;
      box-shadow: 0 6px 18px rgba(0,0,0,0.28);
    }
    .primary:active{ transform: scale(.98); }

    .no{
      background: #fff;
      color: var(--accent);
      position:relative;
    }

    .no:hover{ transform: translateY(-3px); }

    /* Floating hearts container (behind cards) */
    .hearts {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 1;
      overflow: visible;
    }

    .heart {
      position: absolute;
      bottom: -40px;
      font-size: 20px;
      will-change: transform, opacity;
      animation: float linear infinite;
      opacity: 0.95;
      transform-origin: center;
    }

    @keyframes float {
      from { transform: translateY(0) rotate(0deg); opacity: 1; }
      to   { transform: translateY(-110vh) rotate(360deg); opacity: 0; }
    }

    /* Popup - styled like the cards (same look) */
    .popup {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      display: none;
      visibility: hidden;
      justify-content: center;
      align-items: center;
      z-index: 10;
      padding: 1.25rem;
    }

    .popup-content {
      /* Use same treatment as .card for consistent colour/look */
      background: var(--card-bg);
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      color:#fff;
      padding: 3.5rem 4rem;
      border-radius: 2rem;
      text-align:center;
      animation: pop .6s ease;
      max-width: 520px;
      width:100%;
      box-shadow: 0 20px 40px rgba(0,0,0,0.4);
      position:relative;
      border: 1px solid rgba(255,255,255,0.06);
    }

    @keyframes pop {
      from { transform: scale(.92); opacity: 0; }
      to   { transform: scale(1); opacity: 1; }
    }

    .popup-content h2{
      font-size: clamp(1.6rem, 3vw, 2.6rem);
      margin:0 0 1rem;
      font-weight:700;
    }
    .popup-content p{ margin:0; font-size:1.1rem; line-height:1.6; }

    .popup-close {
      position:absolute;
      right: 14px;
      top: 12px;
      background: transparent;
      border: none;
      color: rgba(255,255,255,0.95);
      font-size:1.35rem;
      cursor:pointer;
    }

    /* Backdrop filter fallback and smaller devices tweaks */
    @supports not ((-webkit-backdrop-filter: blur(10px)) or (backdrop-filter: blur(10px))) {
      .card, .popup-content { background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04)); }
    }

    @media (max-width:420px){
      .card { padding:2rem; border-radius:1.25rem; }
      .popup-content { padding:2rem; border-radius:1rem; }
    }

    /* Respect reduced motion for users who request it */
    @media (prefers-reduced-motion: reduce) {
      * { animation: none !important; transition: none !important; }
      .heart { display:none; }
    }
  </style>
</head>

<body>

  <!-- Hearts (decorative, behind cards) -->
  <div class="hearts" id="hearts"></div>

  <!-- SCREEN 1 -->
  <div class="card" id="screen1" aria-hidden="false">
    <h1>üíå New Request</h1>
    <p>You have a request from<br><strong>Mrs. Afraz</strong></p>
    <button type="button" class="primary" id="viewRequestBtn" aria-label="View request">View Request üíñ</button>
  </div>

  <!-- SCREEN 2 -->
  <div class="card" id="screen2" style="display:none;" aria-hidden="true">
    <h1>
      Will you be my Valentine,<br>
      <span>‚ù§Ô∏è Mr Afraz ‚ù§Ô∏è</span>?
    </h1>

    <div class="buttons">
      <button type="button" class="primary" id="yesBtn" aria-label="Say yes">YES üíñ</button>
      <button type="button" class="no" id="noBtn" aria-label="Say no">NO üòà</button>
    </div>
  </div>

  <!-- POPUP -->
  <div class="popup" id="popup" role="dialog" aria-modal="true" aria-labelledby="popupTitle" tabindex="-1">
    <div class="popup-content" role="document">
      <button class="popup-close" id="popupClose" aria-label="Close popup">‚úï</button>
      <h2 id="popupTitle">Aww honey ü•∞üíï</h2>
      <p>
        <span class="line">You're always my Valentine üíç</span><br/>
        <span class="line">Today, tomorrow, and forever üíñ</span>
      </p>
    </div>
  </div>

  <!-- Confetti lib (optional, small CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js" async></script>

  <script>
    // Elements
    const screen1 = document.getElementById('screen1');
    const screen2 = document.getElementById('screen2');
    const viewRequestBtn = document.getElementById('viewRequestBtn');
    const yesBtn = document.getElementById('yesBtn');
    const noBtn = document.getElementById('noBtn');
    const popup = document.getElementById('popup');
    const popupClose = document.getElementById('popupClose');
    const heartsContainer = document.getElementById('hearts');

    // Local state
    const storageKey = 'valentineAccepted';
    let noClickCount = 0;
    const noTexts = [
      'NO üòà',
      'Really? ü§î',
      'Are you sure? üò¢',
      'Think again! üíî',
      'Please? ü•∫',
      'One more chance? üíï',
      'Final answer? üò≠',
      'You break my heart üíî'
    ];

    // Hearts / decorations
    let heartInterval = null;
    function createHeart(){
      const heart = document.createElement('div');
      heart.className = 'heart';
      heart.textContent = '‚ù§Ô∏è';
      // random horizontal position relative to viewport
      const left = Math.random() * 100;
      heart.style.left = left + 'vw';
      // random size
      const size = 14 + Math.random() * 28;
      heart.style.fontSize = size + 'px';
      // random animation duration
      const duration = 4 + Math.random() * 5;
      heart.style.animationDuration = duration + 's';
      heart.style.opacity = 0.9 - Math.random() * 0.5;
      heartsContainer.appendChild(heart);
      // remove after animation
      setTimeout(() => {
        heart.remove();
      }, duration * 1000);
    }

    function startHearts(){
      if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
      if (!heartInterval) heartInterval = setInterval(createHeart, 350);
    }
    function stopHearts(){
      if (heartInterval) { clearInterval(heartInterval); heartInterval = null; }
      // remove remaining hearts
      heartsContainer.querySelectorAll('.heart').forEach(h => h.remove());
    }

    // Show the valentine screen
    function showValentine(){
      screen1.style.display = 'none';
      screen1.setAttribute('aria-hidden', 'true');
      screen2.style.display = 'block';
      screen2.setAttribute('aria-hidden', 'false');
      // ensure hearts running
      startHearts();
      // move focus to first button for keyboard users
      requestAnimationFrame(()=> yesBtn.focus());
    }

    // Popup open/close
    function showPopup(){
      popup.style.display = 'flex';
      popup.style.visibility = 'visible';
      popup.setAttribute('aria-hidden', 'false');
      // stop hearts when celebrating
      stopHearts();

      // confetti burst (if available)
      if (window.confetti && typeof window.confetti === 'function') {
        confetti({
          particleCount: 120,
          spread: 80,
          origin: { y: 0.35 }
        });
      }

      // set accepted in localStorage
      try { localStorage.setItem(storageKey, 'true'); } catch(e){/*ignore*/}

      // focus popup for accessibility
      popup.focus();
    }

    function closePopup(){
      popup.style.display = 'none';
      popup.style.visibility = 'hidden';
      popup.setAttribute('aria-hidden', 'true');
      // restore focus to YES button if visible
      if (screen2.style.display === 'block') yesBtn.focus();
    }

    // NO button: don't move, only change text
    noBtn.addEventListener('pointerenter', () => {
      if (noClickCount < noTexts.length - 1) {
        noClickCount++;
        noBtn.textContent = noTexts[noClickCount];
      }
    });

    // Allow ESC to close popup, and click outside to close
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && popup.style.display === 'flex') {
        closePopup();
      }
    });

    popup.addEventListener('click', (e) => {
      const content = popup.querySelector('.popup-content');
      if (!content.contains(e.target)) {
        closePopup();
      }
    });

    popupClose.addEventListener('click', closePopup);

    // Buttons
    viewRequestBtn.addEventListener('click', showValentine);
    yesBtn.addEventListener('click', () => {
      showPopup();
    });

    // On load, if previously accepted show popup immediately
    function init(){
      const accepted = (function(){
        try { return localStorage.getItem(storageKey) === 'true'; } catch(e){ return false; }
      })();

      if (accepted) {
        // hide initial screens and show popup to celebrate
        screen1.style.display = 'none';
        screen1.setAttribute('aria-hidden', 'true');
        screen2.style.display = 'none';
        screen2.setAttribute('aria-hidden', 'true');
        // show popup (and stop hearts)
        showPopup();
      } else {
        screen1.style.display = 'block';
        screen1.setAttribute('aria-hidden', 'false');
        screen2.style.display = 'none';
        screen2.setAttribute('aria-hidden', 'true');
        startHearts();
      }
    }

    // Kickoff
    init();

    // Make sure hearts pause when page is hidden to be performant
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) stopHearts();
      else {
        try {
          if (localStorage.getItem(storageKey) !== 'true') startHearts();
        } catch(e){}
      }
    });
  </script>
</body>
</html>
